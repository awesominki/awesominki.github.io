---
layout: page
title: 1. 장애 식별
description: >
hide_description: true
sitemap: false
---

>👉 가장 좋지 않은 장애 식별은 고객으로부터 장애가 접수되는 경우입니다. 
이는 고객 경험에 직접적인 영향을 미치며, 기업의 평판에도 부정적인 영향을 줄 수 있습니다. 따라서 장애를 사전에 식별하고 해결하는 것이 중요합니다.

## 1.1 모니터링

- 모니터링은 시스템의 상태를 지속적으로 관찰하고 분석하여 장애를 조기에 식별하고 대응할 수 있도록 하는 필수적인 과정입니다. 효과적인 모니터링은 다음과 같은 요소들로 구성됩니다.

### 1.1.1 **시스템 모니터링**

- **리소스 사용량 추적**: CPU, 메모리, 디스크 I/O, 네트워크 대역폭 등의 리소스 사용량을 실시간으로 모니터링합니다. 이는 시스템의 성능 병목을 조기에 식별하는 데 중요합니다.
- **서버 및 애플리케이션 상태**: 서버의 가용성, 응답 시간, 오류 로그 등을 모니터링하여 서버 상태와 애플리케이션의 작동 여부를 점검합니다.
- **장애 예측**: 머신러닝 기반의 예측 분석을 통해 리소스 사용 패턴을 학습하고, 이상 패턴을 사전에 감지하여 장애를 예방할 수 있습니다.

### 1.1.2 **애플리케이션 모니터링**

- **로그 모니터링**: 애플리케이션 로그를 실시간으로 수집 및 분석하여 오류나 예외를 조기에 탐지합니다. 중앙 집중형 로그 관리 시스템을 통해 모든 로그를 통합하고 분석하는 것이 효과적입니다.
- **성능 모니터링**: 애플리케이션의 응답 시간, 처리량(throughput), 오류율 등을 측정하여 성능 문제를 조기에 식별합니다. APM(Application Performance Monitoring) 도구를 활용하여 성능 병목을 탐지할 수 있습니다.
- **서비스 헬스 체크**: 서비스의 상태를 주기적으로 점검하는 헬스 체크를 구현하여, 서비스의 정상 동작 여부를 확인하고 장애 발생 시 자동으로 알림을 받을 수 있습니다.

### **1.1.3 사용자 경험 모니터링**

- **엔드-투-엔드 모니터링**: 사용자가 서비스를 사용하는 전체 경로를 모니터링하여, 실제 사용자 경험을 기반으로 장애를 식별합니다. 사용자 지연, 실패한 요청 등의 데이터를 수집합니다.  (ex. 셀레니움)
- **사용자 피드백 수집**: 고객 지원 채널을 통해 사용자 피드백을 수집하고, 이를 분석하여 잠재적인 문제를 조기에 식별합니다.
- **리얼 유저 모니터링 (RUM)**: 실제 사용자의 웹 브라우저에서 데이터를 수집하여 페이지 로드 시간, 응답시간 등을 모니터링하고 사용자 경험을 개선합니다. (ex. 구글 애널리틱스)

### **1.1.4 알림 및 경고 시스템**

- **알림 설정**: 임계값을 설정하여 시스템 상태가 비정상일 때 자동으로 알림을 받습니다. 이메일, SMS, 슬랙 등 다양한 채널로 알림을 받을 수 있습니다.
- **경고 기준**: 명확한 경고 기준을 설정하여 불필요한 알림을 줄이고 중요한 장애에 즉시 대응할 수 있도록 합니다. 알림을 많이 설정한다면 오히려 어떤 알림이 주요 알림인지 파악하기 힘들어 질 수 있습니다. 따라서 알림의 채널을 분리하거나 알림 자동화도 방법이 될 수 있습니다.
- **알림 자동화**: 장애 발생 시 자동으로 대응 프로세스를 실행할 수 있도록 자동화된 스크립트를 설정합니다.

### **1.1.5 모니터링 도구**

- **Prometheus & Grafana**: 오픈 소스 모니터링 및 경고 툴로서, 시스템의 메트릭 데이터를 수집하고 시각화하는 데 사용됩니다. Grafana는 Prometheus와 통합하여 대시보드를 생성하고 데이터를 시각적으로 분석하는 데 유용합니다.
- **ELK 스택 (Elasticsearch, Logstash, Kibana)**: 로그 데이터를 수집, 저장, 분석 및 시각화하는 데 사용되는 강력한 도구입니다. 각 컴포넌트는 각각의 역할을 수행하여 대규모 로그 데이터를 효율적으로 처리합니다.
- **New Relic**: 애플리케이션 성능 모니터링(APM) 및 사용자 경험 모니터링을 위한 도구로, 실시간 성능 데이터를 제공하여 문제를 신속히 해결할 수 있도록 돕습니다.

### **1.1.6 모니터링 고려사항**

- **지속적인 모니터링 및 개선**: 모니터링 시스템은 정기적으로 점검하고 조정하여 최신 상태를 유지해야 합니다.
- **중앙 집중식 로그 관리**: 로그는 한 곳에 모아 분석하여 시스템의 전반적인 상태를 명확하게 파악할 수 있어야 합니다.
- **협업과 공유**: 모니터링 데이터를 팀 간에 공유하여 보다 효과적인 장애 대응이 가능하도록 합니다.
- **테스트 및 시뮬레이션**: 장애 시나리오를 테스트하고 모니터링 시스템이 정확하게 작동하는지 검증합니다.

## **1.2 장애 분석 및 진단**

<aside>
👉 장애가 발생하면 신속하고 정확한 분석과 진단이 필요합니다. 장애의 근본 원인을 파악하고 적절한 해결책을 찾는 과정은 다음과 같은 단계로 구성됩니다.

</aside>

### **1.2.1 초기 대응**

- **장애 보고 및 인지**
    - 장애 보고 체계 확립: 누군가가 계속해서 모니터링을 하기에는 실 서비스에서는 많은 인프라가 동작하고 있습니다. 자동 알림 시스템을 통해 장애 발생을 즉시 인지할 수 있도록 설정합니다.
    - 장애 상황 인지: 장애 발생 시, 즉시 관련 팀에게 통보하여 초동 조치를 취할 수 있도록 합니다.
- **초기 평가**
    - 장애의 심각도 평가: 장애의 영향을 평가하여 우선순위를 정합니다. 서비스 중단, 성능 저하, 데이터 손상 등의 영향을 고려합니다.
    - 초기 대응 전략 수립: 장애 상황에 맞는 초기 대응 계획을 수립하고, 관련 리소스를 할당합니다.
- **장애 원인 분석**
    - **문제 재현**: 장애 상황을 재현하여 근본 원인을 명확히 파악합니다. 이를 통해 동일한 상황에서 재발 방지를 위한 구체적인 조치를 설계할 수 있습니다.
    - **장애 패턴 인식**: 장애 로그와 메트릭을 기반으로 과거 유사한 장애 패턴을 분석하여 패턴에 따른 원인을 찾아냅니다.

### **1.2.2 로그 및 메트릭 분석**

- **로그 분석**
    - 로그 수집: 중앙 집중식 로그 관리 시스템에서 로그 데이터를 수집하고 분석합니다.
    - 오류 및 예외 분석: 로그를 통해 애플리케이션에서 발생한 오류와 예외를 추적하여 장애의 원인을 파악합니다.
    - 로그 패턴 분석: 패턴 인식을 통해 과거의 유사한 장애 사례를 파악하고 대응책을 도출합니다.
- **메트릭 분석**
    - 실시간 메트릭 모니터링: CPU 사용률, 메모리 사용량, 네트워크 트래픽 등 실시간 메트릭을 모니터링하여 비정상적인 활동을 탐지합니다.
    - 메트릭 데이터 비교: 정상 상태와 장애 상태의 메트릭을 비교하여 이상 현상을 식별합니다.
    - 임계값 분석: 설정된 임계값을 초과하는 메트릭을 확인하여 장애의 징후를 발견합니다.

### **1.2.3 시스템 및 네트워크 분석**

- **시스템 분석**
    - 프로세스 상태 점검: 시스템에서 실행 중인 프로세스를 점검하여 비정상적으로 작동 중인 프로세스를 식별합니다.
    - 리소스 사용 추적: 시스템 리소스(CPU, 메모리, 디스크 I/O)의 과도한 사용을 추적하여 장애의 원인을 분석합니다.
    - 스레드 덤프 분석: JVM 스레드 덤프를 분석하여 교착 상태(데드락) 및 스레드 고갈 문제를 진단합니다.
- **네트워크 분석**
    - 네트워크 트래픽 모니터링: 네트워크 트래픽을 분석하여 패킷 손실, 지연, 대역폭 초과 등의 문제를 식별합니다.
    - 네트워크 토폴로지 점검: 네트워크 구조를 점검하여 구성상의 문제를 진단합니다.
    - 연결 상태 분석: 외부 시스템 및 API와의 연결 상태를 점검하여 네트워크 장애를 진단합니다.

### **1.2.4 데이터베이스 분석**

- **쿼리 성능 분석**
    - 슬로우 쿼리 로그 분석: 성능이 저하된 쿼리를 식별하고, 인덱스 최적화 및 쿼리 재작성으로 해결합니다.
    - 데이터베이스 락 분석: 락 대기 및 데드락 상황을 식별하고 해결책을 찾습니다.
    - 커넥션 풀 상태 점검: 데이터베이스 커넥션 풀의 상태를 점검하여 연결 문제를 진단합니다.
- **데이터 일관성 점검**
    - 데이터 무결성 확인: 데이터베이스의 무결성을 점검하여 데이터 손상 여부를 확인합니다.
    - 데이터 복구 절차 실행: 손상된 데이터의 복구 절차를 실행하여 데이터베이스의 정상 상태를 복구합니다.