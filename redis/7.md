---
layout: page
title: 7. Spring Boot í”„ë¡œì íŠ¸ì— ìºì‹± ì ìš©í•˜ê¸°
description: >
hide_description: true
sitemap: false
---

## Spring Cache

ìºì‹±ì€ Spring ë‚´ë¶€ì—ì„œë„ ë¹„êµì  ê°„ë‹¨í•˜ê²Œ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëª‡ê°€ì§€ ì„¤ì •ì„ í†µí•´ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ìºì‹±í•  ê²ƒì¸ì§€ë¥¼ ì •í•˜ë©´ ì–´ë…¸í…Œì´ì…˜ì„ í†µí•´ ë©”ì„œë“œì— ì‰½ê²Œ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### `@EnableCaching`

ë¨¼ì € ìƒˆë¡œìš´ `@Configuration`ì„ ë§Œë“¤ê³ , `@EnableCaching`ì„ ì¶”ê°€í•´ ì¤ë‹ˆë‹¤. `@EnableCaching`ì€ ì–´ë…¸í…Œì´ì…˜ì„ ë°”íƒ•ìœ¼ë¡œ ìºì‹±ì„ ì¡°ì ˆí•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.

- **CacheConfig.java**

    ```java
    @Configuration
    @EnableCaching
    public class CacheConfig {
    }
    ```


`@EnableCaching`ì„ ì‚¬ìš©í•˜ë ¤ë©´ ìºì‹œë¥¼ ê´€ë¦¬í•˜ëŠ” `CacheManger`ì˜ êµ¬í˜„ì²´ê°€ Beanìœ¼ë¡œ ë“±ë¡ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ì´ë¥¼ ë™ì¼í•œ `@Configuration`ì— ì¶”ê°€í•´ ë³´ê² ìŠµë‹ˆë‹¤.

- **cacheManager**

    ```java
    // ë‚˜ë¨¸ì§€ import ë¬¸ë“¤
    
    import static org.springframework.data.redis.serializer.RedisSerializationContext.SerializationPair;
    
    @Configuration
    @EnableCaching
    public class CacheConfig {
    
        @Bean
        // CacheManagerë¡œ ì§„í–‰í•´ë„ ì •ìƒ ë™ì‘
        public RedisCacheManager cacheManager(
                RedisConnectionFactory redisConnectionFactory
        ) {
            // ì„¤ì • êµ¬ì„±ì„ ë¨¼ì € ì§„í–‰í•œë‹¤.
            // Redisë¥¼ ì´ìš©í•´ì„œ Spring Cacheë¥¼ ì‚¬ìš©í•  ë•Œ
            // Redis ê´€ë ¨ ì„¤ì •ì„ ëª¨ì•„ë‘ëŠ” í´ë˜ìŠ¤
            RedisCacheConfiguration configuration = RedisCacheConfiguration
                    .defaultCacheConfig()
                    // nullì„ ìºì‹± í• ê²ƒì¸ì§€
                    .disableCachingNullValues()
                    // ê¸°ë³¸ ìºì‹œ ìœ ì§€ ì‹œê°„ (Time To Live)
                    .entryTtl(Duration.ofSeconds(10))
                    // ìºì‹œë¥¼ êµ¬ë¶„í•˜ëŠ” ì ‘ë‘ì‚¬ ì„¤ì •
                    .computePrefixWith(CacheKeyPrefix.simple())
                    // ìºì‹œì— ì €ì¥í•  ê°’ì„ ì–´ë–»ê²Œ ì§ë ¬í™” / ì—­ì§ë ¬í™” í• ê²ƒì¸ì§€
                    .serializeValuesWith(
                            SerializationPair.fromSerializer(RedisSerializer.java())
                    );
                    
            return RedisCacheManager
                    .builder(redisConnectionFactory)
                    .cacheDefaults(configuration)
                    .build();
        }
    }
    ```

    
>    ğŸ’¡ TTLì€ Time To Liveì˜ ì•½ìë¡œ, ìºì‹œê°€ ì–¼ë§ˆë‚˜ ì˜¤ë˜ ìœ ì§€ë˜ëŠ”ì§€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì„¤ì •ì…ë‹ˆë‹¤. ë¹„ìŠ·í•œ ì„¤ì •ìœ¼ë¡  TTI, Time To Idle ì„¤ì •ì´ ìˆëŠ”ë°, ì°¨ì´ì ì€ TTLì€ ì •í•´ì§„ ì‹œê°„ì´ ì§€ë‚˜ë©´ ìë™ìœ¼ë¡œ ì‚¬ë¼ì§€ëŠ” ë°˜ë©´ TTIëŠ” ë¹ˆë²ˆí•˜ê²Œ í™•ì¸ë˜ëŠ” ìºì‹œëŠ” ì œê±°í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì  ë“±ì´ ìˆìŠµë‹ˆë‹¤.

    


ì €í¬ëŠ” Redisë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ” ë§Œí¼, `RedisCacheManager`ë¥¼ ë§Œë“¤ì–´ Beanìœ¼ë¡œ ë“±ë¡í•´ ì£¼ì—ˆìŠµë‹ˆë‹¤.

## ìºì‹±ì´ ì ìš©ë˜ëŠ” ì–´ë…¸í…Œì´ì…˜

`@EnableCaching`ì„ ì ìš©í–ˆë‹¤ë©´, ì´ì œ ì–´ë…¸í…Œì´ì…˜ì„ ë°”íƒ•ìœ¼ë¡œ ë©”ì„œë“œì˜ ê²°ê³¼ë¥¼ ìºì‹±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëŒ€í‘œì ì¸ ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ `@Cacheable`, `@CachePut`, `@CacheEvict`ê°€ ìˆìŠµë‹ˆë‹¤.

### `@Cacheable`

`readOne` ë©”ì„œë“œì— `@Cacheable`ì„ ì¶”ê°€í•´ ë³´ê² ìŠµë‹ˆë‹¤.

- **readOne()**

    ```java
    // cacheNames: ë©”ì„œë“œë¡œ ì¸í•´ì„œ ë§Œë“¤ì–´ì§ˆ ìºì‹œë¥¼ ì§€ì¹­í•˜ëŠ” ì´ë¦„
    // key: ìºì‹œì—ì„œ ë°ì´í„°ë¥¼ êµ¬ë¶„í•˜ê¸° ìœ„í•´ í™œìš©í•  ê°’
    @Cacheable(cacheNames = "itemCache", key = "args[0]")
    public ItemDto readOne(Long id) {
        log.info("Read One: {}", id);
        return repository.findById(id)
                .map(ItemDto::fromEntity)
                .orElseThrow(() 
                        -> new ResponseStatusException(HttpStatus.NOT_FOUND));
    }
    ```

  `cacheNames`ëŠ” Spring ë‚´ë¶€ì—ì„œ ìºì‹œë¥¼ êµ¬ë¶„í•˜ê¸° ìœ„í•´ ë¶™ì—¬ì£¼ëŠ” ì´ë¦„ì…ë‹ˆë‹¤. ë‚˜ì¤‘ì— ìºì‹œëœ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ê³  ì‹¶ë‹¤ë©´, ì´ ì´ë¦„ì„ ê¸°ì–µí•´ì•¼ í•©ë‹ˆë‹¤.

  `key`ëŠ” Redis, ë˜ëŠ” ë‹¤ë¥¸ ìºì‹±ì„ ìœ„í•œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë°ì´í„°ë¥¼ êµ¬ë¶„í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•  ê°’ì„ ì§€ì •í•©ë‹ˆë‹¤. ì—¬ê¸°ì„  SpEL(Spring Expression Language)ë¥¼ ì‚¬ìš©í•˜ëŠ”ë°, ì§€ê¸ˆì€ í˜„ì¬ ë©”ì„œë“œì˜ ì²«ë²ˆì§¸ ì¸ì(`.args[0]`)ì„ ì§€ì •í•˜ê³  ìˆìŠµë‹ˆë‹¤.

ì´ë ‡ê²Œ ì„¤ì •í•œ ë’¤, í•˜ë‚˜ì˜ ì•„ì´í…œ ì¡°íšŒ ìš”ì²­ì„ ë³´ë‚¸ ë’¤, ë°ì´í„°ë² ì´ìŠ¤ì˜ í‚¤ë“¤ì„ í™•ì¸í•´ ë´…ì‹œë‹¤.

![ì´ë ‡ê²Œ](https://teamsparta.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F83c75a39-3aba-4ba4-a792-7aefe4b07895%2Fbaa8af4f-c2b8-4c0b-aa2d-90cbcf0ffff6%2FUntitled.png?table=block&id=bac48c3b-4960-4bea-af9e-638b209ff76f&spaceId=83c75a39-3aba-4ba4-a792-7aefe4b07895&width=910&userId=&cache=v2)

Redisì— ë°ì´í„°ê°€ ì €ì¥ëœê±¸ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`@Cacheable`ì´ í¬í•¨ë˜ê²Œ ë˜ë©´ `CacheConfig`ì—ì„œ ì„¤ì •í•œë°ë¡œ ìºì‹± ì–´ë…¸í…Œì´ì…˜ì´ ë™ì‘í•˜ë©°, ì „ë‹¬ëœ ì¸ìê°€ ë™ì¼í•œ í˜¸ì¶œì— ëŒ€í•˜ì—¬ ìºì‹œì—ì„œ ë°ì´í„°ë¥¼ ëŒë ¤ì£¼ëŠ” Cache Aside ë°©ì‹ì˜ ìºì‹±ì´ ë©ë‹ˆë‹¤. ì¦‰, ì²˜ìŒì—ëŠ” ë©”ì„œë“œë¥¼ ì‹¤í–‰í•´ì„œ ê²°ê³¼ë¥¼ ê°€ì ¸ì˜¤ì§€ë§Œ, í•´ë‹¹ ë°˜í™˜ê°’ì„ ìºì‹œì— ì €ì¥í•œ ë’¤ ìºì‹œê°€ ì‚­ì œë˜ê¸° ì „ê¹Œì§€ëŠ” ë©”ì„œë“œë¥¼ ì‹¤ì œë¡œ ì‹¤í–‰í•˜ì§€ ì•Šê³  ìºì‹œì—ì„œ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ê·¸ë˜ì„œ ë§Œì•½ ë‚´ë¶€ì— ë¡œê·¸ë¥¼ ì‘ì„±í•´ ë‘”ë‹¤ë©´, ì²˜ìŒ í•œë²ˆë§Œ ë¡œê·¸ê°€ ì‘ì„±ë˜ë©° ê·¸ ì´í›„ë¡œëŠ” ì‘ì„±ë˜ì§€ ì•ŠìŒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ëŠ” `readAll`ì— ì ìš©í• ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

- **readAll()**

    ```java
    @Cacheable(cacheNames = "itemAllCache", key = "methodName")
    public List<ItemDto> readAll() {
        return repository.findAll()
                .stream()
                .map(ItemDto::fromEntity)
                .toList();
    }
    ```


`readAll`ì€ (í˜„ì¬ëŠ”) íŠ¹ë³„í•œ ê¸°ëŠ¥ì—†ì´ ë°ì´í„°ë¥¼ ì „ë¶€ ëŒë ¤ì£¼ê¸° ë•Œë¬¸ì—, Keyë¥¼ ë©”ì„œë“œ ì´ë¦„ìœ¼ë¡œ ì„¤ì •í•´ ì£¼ì—ˆìŠµë‹ˆë‹¤.

### `@CachePut`

ì´ë²ˆì—” `create` ë©”ì„œë“œì— `@CachePut`ì„ ì¶”ê°€í•´ ë³´ê² ìŠµë‹ˆë‹¤.

- **create()**

    ```java
    @CachePut(cacheNames = "itemCache", key = "#result.id")
    public ItemDto create(ItemDto dto) {
        return ItemDto.fromEntity(itemRepository.save(Item.builder()
                .name(dto.getName())
                .description(dto.getDescription())
                .price(dto.getPrice())
                .stock(dto.getStock())
                .build()
        ));
    }
    ```


`@Cacheable`ì€ ë°ì´í„°ë¥¼ ìºì‹œì—ì„œ ë°œê²¬í•  ê²½ìš°(Hit), ë©”ì„œë“œ ìì²´ë¥¼ ì‹¤í–‰í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë°˜ë©´, `@CachePut`ì€ í•­ìƒ ë©”ì„œë“œë¥¼ ì‹¤í–‰í•˜ê³ , ê²°ê³¼ë¥¼ ìºì‹±í•©ë‹ˆë‹¤. ì¦‰ ì§€ê¸ˆì²˜ëŸ¼ ìƒì„±, ë˜ëŠ” ìˆ˜ì •ì— ëŒ€í•´ì„œ ì ìš©í•˜ë©´ Write Through ì „ëµì²˜ëŸ¼ ë™ì‘í•©ë‹ˆë‹¤.

ì—¬ê¸°ì„œ ì£¼ëª©í•  ë§Œí•œê±´, `create()`ì˜ ê²½ìš° `key`ë¥¼ `#result.id`ë¡œ ì„¤ì •í•œ ì ì…ë‹ˆë‹¤. ì´ëŠ” ë°˜í™˜ë˜ëŠ” `ItemDto.id`ë¥¼ í™œìš©í•œë‹¤ëŠ” ì˜ë¯¸ì¸ë°, ì´ë ‡ê²Œ ë§Œë“¤ì–´ì§„ ë°ì´í„°ê°€ ìºì‹œì— ì €ì¥ë˜ê¸° ë•Œë¬¸ì— **`readOne` ë©”ì„œë“œë„ ê·¸ ê²°ê³¼ë¥¼ í™œìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ì **ì…ë‹ˆë‹¤.

- **`readOne`ì€ ì‹¤ì œë¡œ ì‹¤í–‰ë˜ì§€ ì•Šì•˜ë‹¤.**

  ![1](https://teamsparta.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F83c75a39-3aba-4ba4-a792-7aefe4b07895%2F40595560-943a-4abc-b5c2-74ebfb57c7e6%2FUntitled.png?table=block&id=59b1a6e0-4fc1-45e3-9736-8604be0aa004&spaceId=83c75a39-3aba-4ba4-a792-7aefe4b07895&width=700&userId=&cache=v2)

  ![2](https://teamsparta.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F83c75a39-3aba-4ba4-a792-7aefe4b07895%2Ffa433330-169b-40ca-87e8-f681f408a8d7%2FUntitled.png?table=block&id=9332f547-91ce-4092-a854-8cd13516dd33&spaceId=83c75a39-3aba-4ba4-a792-7aefe4b07895&width=680&userId=&cache=v2)

  ![3](https://teamsparta.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F83c75a39-3aba-4ba4-a792-7aefe4b07895%2F620fe1f1-5462-4086-bcf4-ee4c0823c14a%2FUntitled.png?table=block&id=24d6014d-f5fb-4c1e-bac6-edc4ce055025&spaceId=83c75a39-3aba-4ba4-a792-7aefe4b07895&width=770&userId=&cache=v2)


ì´ëŠ” Redisì— ì €ì¥í•˜ëŠ” ë°ì´í„°ì˜ Keyê°€ `cacheName::key`ì˜ í˜•íƒœë¡œ ì €ì¥ë˜ê¸° ë•Œë¬¸ì—, `readOne`ì´ ì°¾ëŠ” `cacheName::key`ë„ ë™ì¼í•œ Keyë¥¼ ì°¾ì•„ë‚´ì„œ, Redisì˜ ë°ì´í„°ë¥¼ í™œìš©í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

### `@CacheEvict`

ë§ˆì§€ë§‰ìœ¼ë¡œ `update` ë©”ì„œë“œì— `@CachePut`ê³¼ `@CacheEvict`ë¥¼ ì¶”ê°€í•´ ë³´ê² ìŠµë‹ˆë‹¤.

- **update()**

    ```java
    @CachePut(cacheNames = "itemCache", key = "args[0]")
    @CacheEvict(cacheNames = "itemAllCache", allEntries = true)
    public ItemDto update(Long id, ItemDto dto) {
        Item item = itemRepository.findById(id)
                        .orElseThrow(() -> new ResponseStatusException(HttpStatus.NOT_FOUND));
        item.setName(dto.getName());
        item.setDescription(dto.getDescription());
        item.setPrice(dto.getPrice());
        item.setStock(dto.getStock());
        return ItemDto.fromEntity(itemRepository.save(item));
    }
    ```

Evictë¼ëŠ” ë§ì—ì„œ ìœ ì¶” ê°€ëŠ¥í•˜ë“¯, `@CacheEvict`ëŠ” ì£¼ì–´ì§„ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì €ì¥ëœ ìºì‹œë¥¼ ì§€ì›Œì¤ë‹ˆë‹¤. `key`ë¥¼ í†µí•´ì„œ ëª…í™•íˆ í•˜ë‚˜ì˜ ìºì‹œë¥¼ ì§€ì •í• ìˆ˜ë„ ìˆì§€ë§Œ, ì§€ê¸ˆì€ ëª¨ë“  ì•„ì´í…œì„ ì €ì¥í•œ ìºì‹œì¸ `itemAllCache`ë¥¼ ëª©í‘œë¡œ í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì•„ì´í…œì˜ ì •ë³´ê°€ ë°”ë€Œì—ˆìœ¼ë‹ˆ, **ë°ì´í„°ë¥¼ ì „ë¶€ ëŒë ¤ì¤€ ê²°ê³¼ê°€ ë”ì´ìƒ ìœ íš¨í•˜ì§€ ì•Šë‹¤**ê³  ì´ì•¼ê¸° í•˜ëŠ”ê±°ë¼ ìƒê°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ê²€ìƒ‰ ê²°ê³¼ ìºì‹±

>âš ï¸ ì§„í–‰í•˜ê¸° ì „, `RedisApplication`ì— `@EnableSpringDataWebSupport(pageSerializationMode = VIA_DTO)`ë¥¼ ì¶”ê°€í•´ ì£¼ì„¸ìš”!

```java
@SpringBootApplication
@EnableSpringDataWebSupport(pageSerializationMode = VIA_DTO)
public class RedisApplication {
    // ...
}
```

ë§ˆì§€ë§‰ìœ¼ë¡œ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ìºì‹±í•´ë´…ì‹œë‹¤. ê°€ì¥ ë‹¨ìˆœí•œ ìƒí™©ì¸ ì´ë¦„ì„ ê¸°ì¤€ìœ¼ë¡œ ê²€ìƒ‰ì„ í•´ë³¼ê²ë‹ˆë‹¤. ë¨¼ì € ê°„ë‹¨í•œ JPA Query Method í•˜ë‚˜ë¥¼ ë§Œë“¤ì–´ë´…ì‹œë‹¤.

- **findAllByNameContains**

    ```java
    public interface ItemRepository extends JpaRepository<Item, Long> {
        Page<Item> findAllByNameContains(String name, Pageable pageable);
        // ...
    }
    ```


ê·¸ë¦¬ê³  í•´ë‹¹ ë©”ì„œë“œë¥¼ Serviceì—ì„œ í˜¸ì¶œí•©ë‹ˆë‹¤.

- **searchByName()**

    ```java
    @Cacheable(
            cacheNames = "itemSearchCache", 
            key = "{ args[0], args[1].pageNumber, args[1].pageSize }"
    )
    public Page<ItemDto> searchByName(String query, Pageable pageable) {
        return itemRepository.findAllByNameContains(query, pageable)
                .map(ItemDto::fromEntity);
    }
    ```


ì—¬ê¸°ì„œ `key`ëŠ” ì „ë‹¬ë°›ì€ ì¸ìë¥¼ ë°”íƒ•ìœ¼ë¡œ ë§Œë“¤ì–´ì§€ëŠ”ë°, `query`ë¡œ ì „ë‹¬ëœ ê°’ê³¼, `pageable`ì´ ë“¤ê³  ìˆëŠ” ì •ë³´ ì¤‘ ëª‡ í˜ì´ì§€ì¸ì§€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” `pageNumber`, í˜ì´ì§€ ë‹¹ í¬ê¸°ë¥¼ ë‚˜íƒ€ë‚´ëŠ” `pageSize`ë¥¼ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.

ë§ˆì§€ë§‰ìœ¼ë¡œ Controllerì™€ ì—°ê²°í•´ ë´…ë‹ˆë‹¤.

- **search**

    ```java
    @GetMapping(
            "search"
    )
    public Page<ItemDto> search(
            @RequestParam(name = "q")
            String query,
            Pageable pageable
    ) {
        return itemService.searchByName(query, pageable);
    }
    ```


Googleì˜ ê²€ìƒ‰ URLì„ ë³¸ë”°ì„œ, `q` ë¼ëŠ” íŒŒë¼ë¯¸í„°ë¡œ ê²€ìƒ‰ì–´ë¥¼ ë°›ì€ ë‹¤ìŒ ì„œë¹„ìŠ¤ ë©”ì„œë“œ í˜¸ì¶œ ì‹œ ë„˜ê²¨ì¤ë‹ˆë‹¤.

ì´ì œ ì‹¤í–‰í•˜ê³  í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ë©´,

![ì´ì œ](https://teamsparta.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F83c75a39-3aba-4ba4-a792-7aefe4b07895%2F102d013f-ec06-4b9c-88d3-b1af28178553%2FUntitled.png?table=block&id=1bde7f83-b99b-41bb-8326-8fc35e0c8725&spaceId=83c75a39-3aba-4ba4-a792-7aefe4b07895&width=1040&userId=&cache=v2)

ì „ë‹¬í–ˆë˜ ìºì‹œ ì´ë¦„, `query`ë¡œ ì „ë‹¬í•œ ë°ì´í„°, ê·¸ë¦¬ê³  í˜ì´ì§€ ì •ë³´ë¡œ ì „ë‹¬í•œ 0í˜ì´ì§€ 20ì¥ê¹Œì§€ í•©ì³ì„œ í‚¤ê°€ ë§Œë“¤ì–´ì§„ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.